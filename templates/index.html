<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í—¬ë¯¸ì‰ª - ë‚˜ë§Œì˜ AI ìš”ë¦¬ ë¹„ì„œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        @keyframes bounce-slow {

            0%,
            100% {
                transform: translateY(-5%);
            }

            50% {
                transform: translateY(5%);
            }
        }

        .animate-bounce-slow {
            animation: bounce-slow 2s infinite;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-orange-50 to-orange-100 min-h-screen text-gray-800">

    <!-- Mobile App Container -->
    <div class="max-w-md mx-auto min-h-screen bg-white shadow-2xl overflow-hidden relative flex flex-col">

        <!-- Header -->
        <header
            class="p-5 flex justify-between items-center bg-white/80 sticky top-0 z-50 backdrop-blur-md border-b border-orange-100">
            <div class="flex items-center gap-2">
                <div class="bg-orange-500 rounded-lg p-1.5">
                    <i data-lucide="chef-hat" class="text-white w-6 h-6"></i>
                </div>
                <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-red-500">
                    í—¬ë¯¸ì‰ª</h1>
            </div>
            <button class="p-2 hover:bg-orange-50 rounded-full transition-colors">
                <i data-lucide="bell" class="text-gray-600 w-6 h-6"></i>
            </button>
        </header>

        <!-- Main Content Areas -->
        <main class="flex-grow overflow-y-auto hide-scrollbar pb-24 relative">

            <!-- VIEW: HOME -->
            <div id="view-home" class="p-5 transition-opacity duration-300">
                <!-- Hero Section -->
                <div class="mb-8 text-center" id="hero-section">
                    <div class="inline-block p-4 mb-4 bg-orange-100 rounded-full animate-bounce-slow">
                        <span class="text-4xl">ğŸ³</span>
                    </div>
                    <h2 class="text-2xl font-bold mb-2 text-gray-800">ì–´ë–¤ ìš”ë¦¬ë¥¼ ë„ì™€ë“œë¦´ê¹Œìš”?</h2>
                    <p class="text-gray-500 text-sm">ìœ íŠœë¸Œ ë§í¬ë§Œ ë„£ìœ¼ë©´ ë ˆì‹œí”¼ê°€ ëšë”±!</p>
                </div>

                <!-- Input Area -->
                <div class="relative mb-8 group">
                    <div
                        class="absolute inset-0 bg-gradient-to-r from-orange-400 to-pink-500 rounded-2xl blur opacity-25 group-hover:opacity-40 transition duration-300">
                    </div>
                    <div class="relative bg-white rounded-2xl p-2 shadow-lg flex items-center border border-orange-100">
                        <div class="pl-3 text-orange-400">
                            <i data-lucide="youtube" class="w-5 h-5"></i>
                        </div>
                        <input type="text" id="youtube-url"
                            class="w-full p-3 bg-transparent outline-none text-gray-700 placeholder-gray-400"
                            placeholder="ìœ íŠœë¸Œ URL ë¶™ì—¬ë„£ê¸°...">
                        <button onclick="extractRecipe()"
                            class="bg-gradient-to-r from-orange-500 to-red-500 text-white p-3 rounded-xl shadow-md transform active:scale-95 transition-all hover:shadow-lg">
                            <i data-lucide="arrow-right" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="loading" class="hidden flex-col items-center justify-center py-10 fade-in">
                    <div
                        class="w-16 h-16 border-4 border-orange-200 border-t-orange-500 rounded-full animate-spin mb-4">
                    </div>
                    <p class="text-orange-600 font-medium animate-pulse">AI ì‰í”„ê°€ ì˜ìƒì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
                    <p class="text-gray-400 text-xs mt-2">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” (ì•½ 10~30ì´ˆ)</p>
                </div>

                <!-- Result Section -->
                <div id="result" class="hidden text-left space-y-6 animate-fade-in-up">
                    <!-- Recipe Header -->
                    <div class="bg-white rounded-3xl p-5 shadow-lg border border-orange-50 relative">
                        <div class="flex items-start justify-between mb-3">
                            <span class="px-3 py-1 bg-orange-100 text-orange-600 text-xs font-bold rounded-full">AI ë¶„ì„
                                ì™„ë£Œ</span>
                            <button onclick="toggleBookmark()" id="btn-bookmark"
                                class="text-gray-300 hover:text-red-500 transition-colors">
                                <i data-lucide="heart" class="w-6 h-6 fill-current"></i>
                            </button>
                        </div>
                        <img id="recipe-thumb" src="" class="w-full h-48 object-cover rounded-xl mb-4 hidden">
                        <h2 id="recipe-title" class="text-2xl font-bold text-gray-800 mb-2 leading-tight"></h2>
                        <p id="recipe-desc" class="text-gray-500 text-sm mb-4"></p>
                    </div>

                    <!-- Ingredients -->
                    <div class="bg-white rounded-3xl p-0 overflow-hidden shadow-lg border border-orange-50">
                        <div class="bg-orange-50/50 p-4 border-b border-orange-100">
                            <h3 class="font-bold flex items-center gap-2 text-gray-800">
                                <i data-lucide="shopping-bag" class="w-4 h-4 text-orange-500"></i> ì¬ë£Œ ì¤€ë¹„
                            </h3>
                        </div>
                        <ul id="recipe-ingredients" class="p-5 space-y-3 text-sm text-gray-600"></ul>
                    </div>

                    <!-- Steps -->
                    <div class="bg-white rounded-3xl p-0 overflow-hidden shadow-lg border border-orange-50">
                        <div class="bg-orange-50/50 p-4 border-b border-orange-100">
                            <h3 class="font-bold flex items-center gap-2 text-gray-800">
                                <i data-lucide="list-checks" class="w-4 h-4 text-orange-500"></i> ì¡°ë¦¬ ìˆœì„œ
                            </h3>
                        </div>
                        <div id="recipe-steps" class="p-5 space-y-6"></div>
                    </div>

                    <!-- Tips -->
                    <div id="tips-container" class="bg-yellow-50 rounded-2xl p-5 border border-yellow-200 hidden">
                        <h3 class="font-bold text-yellow-800 mb-2 flex items-center gap-2">
                            <i data-lucide="lightbulb" class="w-4 h-4"></i> ì‰í”„ì˜ íŒ
                        </h3>
                        <ul id="recipe-tips" class="text-sm text-yellow-700 list-disc list-inside space-y-1"></ul>
                    </div>
                </div>
            </div>

            <!-- VIEW: BOOKMARKS -->
            <div id="view-bookmarks" class="hidden p-5">
                <h2 class="text-2xl font-bold mb-6">ë‚´ê°€ ì°œí•œ ë ˆì‹œí”¼ ğŸ“š</h2>
                <div id="bookmarks-list" class="grid grid-cols-1 gap-4">
                    <!-- Bookmarks injected here -->
                    <div class="text-center py-10 text-gray-400">ì €ì¥ëœ ë ˆì‹œí”¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
            </div>

            <!-- VIEW: MY PAGE -->
            <div id="view-mypage" class="hidden p-5">
                <h2 class="text-2xl font-bold mb-6">ë§ˆì´í˜ì´ì§€ ğŸ‘¤</h2>

                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 mb-6 text-center">
                    <div
                        class="w-20 h-20 bg-orange-100 rounded-full mx-auto mb-4 flex items-center justify-center text-3xl">
                        ğŸ‘¨â€ğŸ³</div>
                    <h3 class="text-lg font-bold">ë‚˜ë§Œì˜ ì‰í”„</h3>
                    <p class="text-gray-500 text-sm">ìš”ë¦¬ ì´ˆë³´ íƒˆì¶œ ì¤‘!</p>
                </div>

                <div class="space-y-3">
                    <div class="bg-white rounded-xl p-4 shadow-sm flex items-center justify-between">
                        <span class="flex items-center gap-3"><i data-lucide="settings"
                                class="w-5 h-5 text-gray-400"></i> ì„¤ì •</span>
                        <i data-lucide="chevron-right" class="w-4 h-4 text-gray-300"></i>
                    </div>
                    <div class="bg-white rounded-xl p-4 shadow-sm flex items-center justify-between">
                        <span class="flex items-center gap-3"><i data-lucide="help-circle"
                                class="w-5 h-5 text-gray-400"></i> ë„ì›€ë§</span>
                        <i data-lucide="chevron-right" class="w-4 h-4 text-gray-300"></i>
                    </div>
                </div>

                <div class="mt-8 p-4 bg-orange-50 rounded-xl">
                    <h4 class="font-bold text-orange-800 mb-2">Gemini API Key ìƒíƒœ</h4>
                    <p class="text-sm text-orange-600">
                        í˜„ì¬ .env ì„¤ì •ì´ <span class="font-bold md:">í™œì„±í™”</span> ë˜ì–´ ìˆìŠµë‹ˆë‹¤. (ì˜ˆì‹œ)
                    </p>
                </div>
            </div>

        </main>

        <!-- Bottom Nav -->
        <nav
            class="bg-white border-t border-gray-100 p-3 flex justify-around items-center absolute bottom-0 w-full pb-6 z-40">
            <button onclick="switchView('home')" id="nav-home"
                class="flex flex-col items-center gap-1 text-orange-500 transition-colors">
                <i data-lucide="home" class="w-6 h-6"></i>
                <span class="text-[10px] font-medium">í™ˆ</span>
            </button>
            <button onclick="switchView('bookmarks')" id="nav-bookmarks"
                class="flex flex-col items-center gap-1 text-gray-300 hover:text-gray-500 transition-colors">
                <i data-lucide="book-open" class="w-6 h-6"></i>
                <span class="text-[10px] font-medium">ë¶ë§ˆí¬</span>
            </button>
            <button onclick="switchView('mypage')" id="nav-mypage"
                class="flex flex-col items-center gap-1 text-gray-300 hover:text-gray-500 transition-colors">
                <i data-lucide="user" class="w-6 h-6"></i>
                <span class="text-[10px] font-medium">ë§ˆì´</span>
            </button>
        </nav>

    </div>

    <script>
        lucide.createIcons();
        let currentRecipe = null; // Store current recipe for bookmarking

        // Navigation Logic
        function switchView(viewName) {
            // Hide all views
            ['home', 'bookmarks', 'mypage'].forEach(v => {
                document.getElementById('view-' + v).classList.add('hidden');
                const btn = document.getElementById('nav-' + v);
                btn.classList.remove('text-orange-500');
                btn.classList.add('text-gray-300');
            });

            // Show selected view
            document.getElementById('view-' + viewName).classList.remove('hidden');
            const activeBtn = document.getElementById('nav-' + viewName);
            activeBtn.classList.add('text-orange-500');
            activeBtn.classList.remove('text-gray-300');

            if (viewName === 'bookmarks') loadBookmarks();
        }

        // Bookmark Logic
        async function loadBookmarks() {
            const list = document.getElementById('bookmarks-list');
            list.innerHTML = '<div class="text-center py-10"><div class="animate-spin w-6 h-6 border-2 border-orange-500 rounded-full mx-auto"></div></div>';

            try {
                const res = await fetch('/api/bookmarks');
                const bookmarks = await res.json();

                if (bookmarks.length === 0) {
                    list.innerHTML = '<div class="text-center py-10 text-gray-400">ì €ì¥ëœ ë ˆì‹œí”¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }

                list.innerHTML = '';
                bookmarks.forEach(b => {
                    list.innerHTML += `
                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden flex gap-3 p-3 relative cursor-pointer hover:bg-orange-50 transition-colors" onclick="loadRecipeFromBookmark('${b.id}')">
                            <img src="${b.thumbnail || 'https://via.placeholder.com/100'}" class="w-20 h-20 object-cover rounded-lg flex-shrink-0 bg-gray-200">
                            <div class="flex-grow">
                                <h4 class="font-bold text-gray-800 line-clamp-1">${b.title}</h4>
                                <p class="text-xs text-gray-500 line-clamp-2 mt-1">${b.description}</p>
                                <button onclick="event.stopPropagation(); deleteBookmark('${b.id}')" class="absolute bottom-3 right-3 text-gray-300 hover:text-red-500"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                            </div>
                        </div>
                    `;
                });
                lucide.createIcons();
            } catch (e) {
                list.innerHTML = '<div class="text-center text-red-500">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</div>';
            }
        }

        async function toggleBookmark() {
            if (!currentRecipe) return;
            const btn = document.getElementById('btn-bookmark');

            try {
                const res = await fetch('/api/bookmarks', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(currentRecipe)
                });
                const data = await res.json();

                if (res.ok) {
                    btn.classList.add('text-red-500');
                    btn.classList.remove('text-gray-300');
                    alert('ë¶ë§ˆí¬ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    alert(data.message || 'ì´ë¯¸ ì €ì¥ë˜ì–´ ìˆê±°ë‚˜ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (e) {
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function deleteBookmark(id) {
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            await fetch('/api/bookmarks/' + id, { method: 'DELETE' });
            loadBookmarks(); // Refresh
        }

        async function loadRecipeFromBookmark(id) {
            try {
                const res = await fetch('/api/bookmarks');
                const bookmarks = await res.json();
                const recipe = bookmarks.find(b => b.id === id);

                if (recipe) {
                    currentRecipe = recipe;
                    // Render Data (Similar to extractRecipe)
                    document.getElementById('recipe-title').innerText = recipe.title;
                    document.getElementById('recipe-desc').innerText = recipe.description;

                    const thumb = document.getElementById('recipe-thumb');
                    if (recipe.thumbnail) {
                        thumb.src = recipe.thumbnail;
                        thumb.classList.remove('hidden');
                    }

                    const ingList = document.getElementById('recipe-ingredients');
                    ingList.innerHTML = '';
                    (recipe.ingredients || []).forEach(ing => {
                        ingList.innerHTML += `<li class="flex items-center gap-3"><div class="w-1.5 h-1.5 rounded-full bg-orange-300"></div><span class="text-gray-700">${ing}</span></li>`;
                    });

                    const stepList = document.getElementById('recipe-steps');
                    stepList.innerHTML = '';
                    (recipe.steps || []).forEach((step, index) => {
                        stepList.innerHTML += `<div class="flex gap-4"><div class="flex-shrink-0 w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center text-orange-600 font-bold text-sm">${index + 1}</div><p class="text-gray-600 text-sm leading-relaxed pt-1.5">${step}</p></div>`;
                    });

                    const tipsContainer = document.getElementById('tips-container');
                    if (recipe.tips && recipe.tips.length > 0) {
                        const tipsList = document.getElementById('recipe-tips');
                        tipsList.innerHTML = '';
                        recipe.tips.forEach(tip => tipsList.innerHTML += `<li>${tip}</li>`);
                        tipsContainer.classList.remove('hidden');
                    } else {
                        tipsContainer.classList.add('hidden');
                    }

                    // Show result in Home
                    document.getElementById('result').classList.remove('hidden');
                    document.getElementById('hero-section').classList.add('hidden');

                    // Set Bookmark state
                    const btn = document.getElementById('btn-bookmark');
                    btn.classList.add('text-red-500');
                    btn.classList.remove('text-gray-300');

                    switchView('home');
                    lucide.createIcons();
                }
            } catch (e) {
                console.error(e);
                alert('ë ˆì‹œí”¼ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // Extraction Logic
        async function extractRecipe() {
            const url = document.getElementById('youtube-url').value;
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            const hero = document.getElementById('hero-section');
            const btnBookmark = document.getElementById('btn-bookmark');

            if (!url) { alert("ìœ íŠœë¸Œ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }

            hero.classList.add('hidden');
            result.classList.add('hidden');
            loading.classList.remove('hidden');
            btnBookmark.classList.remove('text-red-500'); // Reset bookmark state
            btnBookmark.classList.add('text-gray-300');

            try {
                const formData = new FormData();
                formData.append('url', url);

                const response = await fetch('/extract', { method: 'POST', body: formData });
                if (!response.ok) throw new Error('ë ˆì‹œí”¼ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');

                const data = await response.json();
                currentRecipe = data; // Save for bookmarking

                // Render Data
                document.getElementById('recipe-title').innerText = data.title;
                document.getElementById('recipe-desc').innerText = data.description;

                const thumb = document.getElementById('recipe-thumb');
                if (data.thumbnail) {
                    thumb.src = data.thumbnail;
                    thumb.classList.remove('hidden');
                }

                const ingList = document.getElementById('recipe-ingredients');
                ingList.innerHTML = '';
                (data.ingredients || []).forEach(ing => {
                    ingList.innerHTML += `<li class="flex items-center gap-3"><div class="w-1.5 h-1.5 rounded-full bg-orange-300"></div><span class="text-gray-700">${ing}</span></li>`;
                });

                const stepList = document.getElementById('recipe-steps');
                stepList.innerHTML = '';
                (data.steps || []).forEach((step, index) => {
                    stepList.innerHTML += `<div class="flex gap-4"><div class="flex-shrink-0 w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center text-orange-600 font-bold text-sm">${index + 1}</div><p class="text-gray-600 text-sm leading-relaxed pt-1.5">${step}</p></div>`;
                });

                const tipsContainer = document.getElementById('tips-container');
                if (data.tips && data.tips.length > 0) {
                    const tipsList = document.getElementById('recipe-tips');
                    tipsList.innerHTML = '';
                    data.tips.forEach(tip => tipsList.innerHTML += `<li>${tip}</li>`);
                    tipsContainer.classList.remove('hidden');
                } else {
                    tipsContainer.classList.add('hidden');
                }

                loading.classList.add('hidden');
                result.classList.remove('hidden');
                lucide.createIcons();

            } catch (error) {
                console.error(error);
                loading.classList.add('hidden');
                hero.classList.remove('hidden');
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
    </script>
</body>

</html>